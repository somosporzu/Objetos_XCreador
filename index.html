<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Objetos PAPA</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Iconos
        const BookIcon = () => (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
        );

        const Trash2Icon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const DownloadIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        );

        // Datos
        const RARITIES = {
            'Poco ComÃºn': { min: 3, max: 5, price: '200-500 L' },
            'Raro': { min: 6, max: 10, price: '500-2,000 L' },
            'Muy Raro': { min: 11, max: 15, price: '2,000-10,000 L' },
            'Legendario': { min: 16, max: 25, price: 'Sin precio' }
        };

        const PROPERTIES = {
            'Bonificadores a Atributos': [
                { name: '+1 a un Atributo', cost: 3, note: 'MÃ¡ximo +3 en un objeto' },
                { name: '+1 a dos Atributos', cost: 5, note: 'Muy raro' },
                { name: '+1 a los tres Atributos', cost: 8, note: 'Solo Legendario+' }
            ],
            'Bonificadores a Combate': [
                { name: '+1 a tiradas de ataque', cost: 2, note: 'Solo armas' },
                { name: '+1 al daÃ±o', cost: 2, note: 'Solo armas' },
                { name: '+1 a Defensa', cost: 2, note: 'Armaduras, escudos' },
                { name: '+1 a Iniciativa', cost: 2, note: 'Accesorios, armas ligeras' }
            ],
            'CuraciÃ³n': [
                { name: 'CuraciÃ³n Menor (1d6+2)', cost: 1, note: 'Restaura Resistencia' },
                { name: 'CuraciÃ³n (2d6+2)', cost: 2, note: 'Restaura Resistencia' },
                { name: 'CuraciÃ³n Mayor (3d6+4)', cost: 3, note: 'Restaura Resistencia' },
                { name: 'CuraciÃ³n Completa', cost: 5, note: 'Restaura toda Resistencia' }
            ],
            'Movimiento': [
                { name: 'Pies Ligeros', cost: 2, note: 'Ignora terreno difÃ­cil' },
                { name: 'Vuelo Limitado', cost: 5, note: '18m, 1/dÃ­a, 3 rondas' },
                { name: 'VisiÃ³n en Oscuridad', cost: 2, note: 'Ver en oscuridad 15m' }
            ],
            'ProtecciÃ³n': [
                { name: 'Resistencia a Tipo DaÃ±o', cost: 4, note: 'Mitad de daÃ±o' },
                { name: 'Inmunidad a Estado', cost: 3, note: 'Envenenado, Asustado' },
                { name: 'AbsorciÃ³n', cost: 2, note: 'Ignora 1 pto daÃ±o' }
            ]
        };

        const REQUIREMENTS = [
            { name: 'SintonÃ­a', cost: -1, desc: 'Descanso largo para activar' },
            { name: 'Herencia EspecÃ­fica', cost: -2, desc: 'Solo una Herencia' },
            { name: 'Concepto EspecÃ­fico', cost: -2, desc: 'Requiere Concepto' },
            { name: 'Atributo MÃ­nimo', cost: -1, desc: 'Valor mÃ­nimo' }
        ];

        const CURSES = [
            { name: 'Menor', cost: 2, desc: 'Desventaja, -1 Atributo' },
            { name: 'Mayor', cost: 4, desc: '-2 Atributo, vulnerabilidad' },
            { name: 'Severa', cost: 6, desc: 'TransformaciÃ³n, parasitismo' },
            { name: 'Legendaria', cost: 8, desc: 'PÃ©rdida de humanidad' }
        ];

        const CONSUMABLE_TYPES = {
            'PociÃ³n': { formula: (ppp) => ppp * 50, action: 'AcciÃ³n RÃ¡pida', icon: 'ðŸ§ª' },
            'Pergamino': { formula: (ppp) => ppp * 75, action: 'AcciÃ³n Principal', icon: 'ðŸ“œ' },
            'TalismÃ¡n': { formula: (ppp) => ppp * 60, action: 'AutomÃ¡tico', icon: 'âœ¨' },
            'Aceite': { formula: (ppp) => ppp * 40, action: '1 minuto', icon: 'ðŸ«™' }
        };

        // Componente Principal
        const ItemCreator = () => {
            const [activeTab, setActiveTab] = useState('objects');
            const [item, setItem] = useState({ 
                name: '', rarity: 'Raro', properties: [], requirements: [], curses: [] 
            });
            const [consumable, setConsumable] = useState({ 
                name: '', type: 'PociÃ³n', properties: [], requirements: [], curses: [], quantity: 1 
            });
            const [selectedCategory, setSelectedCategory] = useState('');

            const calculatePPP = (data) => {
                return data.properties.reduce((s, p) => s + p.cost, 0) +
                       data.requirements.reduce((s, r) => s + r.cost, 0) +
                       data.curses.reduce((s, c) => s + c.cost, 0);
            };

            const itemPPP = calculatePPP(item);
            const consumablePPP = calculatePPP(consumable);

            const addItem = (itemData, type, isConsumable) => {
                const setter = isConsumable ? setConsumable : setItem;
                setter(prev => ({
                    ...prev,
                    [type]: [...prev[type], { ...itemData, id: Date.now() }]
                }));
            };

            const removeItem = (id, type, isConsumable) => {
                const setter = isConsumable ? setConsumable : setItem;
                setter(prev => ({
                    ...prev,
                    [type]: prev[type].filter(i => i.id !== id)
                }));
            };

            const getRarityFromPPP = (ppp) => {
                for (const [rarity, range] of Object.entries(RARITIES)) {
                    if (ppp >= range.min && ppp <= range.max) return rarity;
                }
                return 'Fuera de rango';
            };

            const exportData = (isConsumable) => {
                const data = isConsumable ? consumable : item;
                const ppp = isConsumable ? consumablePPP : itemPPP;
                
                let text = `${data.name}\n`;
                
                if (isConsumable) {
                    const typeData = CONSUMABLE_TYPES[data.type];
                    const price = typeData.formula(ppp);
                    text += `Tipo: ${data.type}\nRareza: ${getRarityFromPPP(ppp)} (${ppp} PPP)\n`;
                    text += `\nEFECTOS:\n${data.properties.map(p => `â€¢ ${p.name}`).join('\n')}\n`;
                    text += `\nPrecio: ${price * data.quantity} L (${data.quantity} unidades)`;
                } else {
                    text += `Rareza: ${data.rarity} (${ppp} PPP)\n`;
                    text += `\nPROPIEDADES:\n${data.properties.map(p => `â€¢ ${p.name}`).join('\n')}\n`;
                }
                
                if (data.requirements.length > 0) {
                    text += `\nREQUISITOS:\n${data.requirements.map(r => `â€¢ ${r.name}`).join('\n')}\n`;
                }
                if (data.curses.length > 0) {
                    text += `\nMALDICIONES:\n${data.curses.map(c => `â€¢ ${c.name}`).join('\n')}`;
                }
                
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${data.name || 'objeto'}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-4">
                    <div className="max-w-6xl mx-auto">
                        <header className="bg-gradient-to-r from-amber-800 to-orange-700 text-white p-6 rounded-lg shadow-xl mb-6">
                            <div className="flex items-center gap-3 mb-4">
                                <BookIcon />
                                <div>
                                    <h1 className="text-3xl font-bold">Creador de Objetos PAPA</h1>
                                    <p className="text-amber-100">Sistema PPP con Requisitos y Maldiciones</p>
                                </div>
                            </div>
                            
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setActiveTab('objects')}
                                    className={`px-4 py-2 rounded-lg font-semibold ${activeTab === 'objects' ? 'bg-white text-amber-800' : 'bg-amber-700 text-white'}`}
                                >
                                    ðŸ“¿ Permanentes
                                </button>
                                <button
                                    onClick={() => setActiveTab('consumables')}
                                    className={`px-4 py-2 rounded-lg font-semibold ${activeTab === 'consumables' ? 'bg-white text-amber-800' : 'bg-amber-700 text-white'}`}
                                >
                                    ðŸ§ª Consumibles
                                </button>
                            </div>
                        </header>

                        {activeTab === 'consumables' ? (
                            <ConsumableCreator 
                                consumable={consumable}
                                setConsumable={setConsumable}
                                ppp={consumablePPP}
                                category={selectedCategory}
                                setCategory={setSelectedCategory}
                                onAdd={addItem}
                                onRemove={removeItem}
                                getRarity={getRarityFromPPP}
                                onExport={() => exportData(true)}
                            />
                        ) : (
                            <ObjectCreator 
                                item={item}
                                setItem={setItem}
                                ppp={itemPPP}
                                category={selectedCategory}
                                setCategory={setSelectedCategory}
                                onAdd={addItem}
                                onRemove={removeItem}
                                onExport={() => exportData(false)}
                            />
                        )}
                    </div>
                </div>
            );
        };

        // Componente Consumibles
        const ConsumableCreator = ({ consumable, setConsumable, ppp, category, setCategory, onAdd, onRemove, getRarity, onExport }) => {
            const typeData = CONSUMABLE_TYPES[consumable.type];
            const price = typeData.formula(ppp) * consumable.quantity;

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-2 space-y-4">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold mb-4">InformaciÃ³n</h2>
                            <input
                                type="text"
                                value={consumable.name}
                                onChange={(e) => setConsumable(p => ({ ...p, name: e.target.value }))}
                                className="w-full px-3 py-2 border rounded mb-3"
                                placeholder="Nombre"
                            />
                            <select
                                value={consumable.type}
                                onChange={(e) => setConsumable(p => ({ ...p, type: e.target.value }))}
                                className="w-full px-3 py-2 border rounded"
                            >
                                {Object.entries(CONSUMABLE_TYPES).map(([t, d]) => (
                                    <option key={t} value={t}>{d.icon} {t}</option>
                                ))}
                            </select>
                        </div>

                        <PropertySelector
                            title="Efectos"
                            items={consumable.properties}
                            category={category}
                            setCategory={setCategory}
                            onAdd={(p) => onAdd(p, 'properties', true)}
                            onRemove={(id) => onRemove(id, 'properties', true)}
                            color="purple"
                        />

                        <RequirementSelector
                            items={consumable.requirements}
                            onAdd={(r) => onAdd(r, 'requirements', true)}
                            onRemove={(id) => onRemove(id, 'requirements', true)}
                        />

                        <CurseSelector
                            items={consumable.curses}
                            onAdd={(c) => onAdd(c, 'curses', true)}
                            onRemove={(id) => onRemove(id, 'curses', true)}
                            onUpdate={(id, details) => {
                                setConsumable(p => ({
                                    ...p,
                                    curses: p.curses.map(c => c.id === id ? { ...c, details } : c)
                                }));
                            }}
                        />

                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold mb-4">Cantidad</h2>
                            <div className="flex items-center gap-4">
                                <button
                                    onClick={() => setConsumable(p => ({ ...p, quantity: Math.max(1, p.quantity - 1) }))}
                                    className="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg font-bold"
                                >-</button>
                                <input
                                    type="number"
                                    value={consumable.quantity}
                                    onChange={(e) => setConsumable(p => ({ ...p, quantity: Math.max(1, parseInt(e.target.value) || 1) }))}
                                    className="w-20 text-center text-2xl font-bold border rounded"
                                />
                                <button
                                    onClick={() => setConsumable(p => ({ ...p, quantity: p.quantity + 1 }))}
                                    className="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg font-bold"
                                >+</button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div className="bg-white rounded-lg shadow-lg p-6 sticky top-4">
                            <h2 className="text-xl font-bold mb-4">Resumen</h2>
                            <div className="space-y-4">
                                <div className="bg-purple-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600">Tipo</div>
                                    <div className="text-xl font-bold">{typeData.icon} {consumable.type}</div>
                                </div>
                                <div className="bg-amber-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600">Rareza</div>
                                    <div className="text-lg font-bold">{getRarity(ppp)}</div>
                                    <div className="text-xs text-gray-600">{ppp} PPP</div>
                                </div>
                                <div className="text-sm space-y-2">
                                    <div className="flex justify-between border-t pt-2">
                                        <span>Precio Total:</span>
                                        <span className="text-2xl font-bold">{price} L</span>
                                    </div>
                                </div>
                                <button
                                    onClick={onExport}
                                    disabled={!consumable.name}
                                    className="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold disabled:opacity-50 flex items-center justify-center gap-2"
                                >
                                    <DownloadIcon />Exportar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Componente Objetos
        const ObjectCreator = ({ item, setItem, ppp, category, setCategory, onAdd, onRemove, onExport }) => {
            const isValid = ppp >= RARITIES[item.rarity].min && ppp <= RARITIES[item.rarity].max;

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-2 space-y-4">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold mb-4">InformaciÃ³n</h2>
                            <input
                                type="text"
                                value={item.name}
                                onChange={(e) => setItem(p => ({ ...p, name: e.target.value }))}
                                className="w-full px-3 py-2 border rounded mb-3"
                                placeholder="Nombre"
                            />
                            <select
                                value={item.rarity}
                                onChange={(e) => setItem(p => ({ ...p, rarity: e.target.value }))}
                                className="w-full px-3 py-2 border rounded"
                            >
                                {Object.keys(RARITIES).map(r => (
                                    <option key={r} value={r}>{r}</option>
                                ))}
                            </select>
                        </div>

                        <PropertySelector
                            title="Propiedades"
                            items={item.properties}
                            category={category}
                            setCategory={setCategory}
                            onAdd={(p) => onAdd(p, 'properties', false)}
                            onRemove={(id) => onRemove(id, 'properties', false)}
                            color="amber"
                        />

                        <RequirementSelector
                            items={item.requirements}
                            onAdd={(r) => onAdd(r, 'requirements', false)}
                            onRemove={(id) => onRemove(id, 'requirements', false)}
                        />

                        <CurseSelector
                            items={item.curses}
                            onAdd={(c) => onAdd(c, 'curses', false)}
                            onRemove={(id) => onRemove(id, 'curses', false)}
                            onUpdate={(id, details) => {
                                setItem(p => ({
                                    ...p,
                                    curses: p.curses.map(c => c.id === id ? { ...c, details } : c)
                                }));
                            }}
                        />
                    </div>

                    <div>
                        <div className="bg-white rounded-lg shadow-lg p-6 sticky top-4">
                            <h2 className="text-xl font-bold mb-4">Resumen</h2>
                            <div className="space-y-4">
                                <div className="bg-amber-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600">Presupuesto {item.rarity}</div>
                                    <div className="text-2xl font-bold">
                                        {RARITIES[item.rarity].min}-{RARITIES[item.rarity].max} PPP
                                    </div>
                                </div>
                                <div className={`p-4 rounded-lg ${isValid ? 'bg-green-100' : 'bg-red-100'}`}>
                                    <div className="text-sm text-gray-600">Coste Total</div>
                                    <div className={`text-3xl font-bold ${isValid ? 'text-green-700' : 'text-red-700'}`}>
                                        {ppp} PPP
                                    </div>
                                </div>
                                <button
                                    onClick={onExport}
                                    disabled={!item.name}
                                    className="w-full bg-amber-600 text-white py-3 rounded-lg font-semibold disabled:opacity-50 flex items-center justify-center gap-2"
                                >
                                    <DownloadIcon />Exportar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Componentes reutilizables
        const PropertySelector = ({ title, items, category, setCategory, onAdd, onRemove, color }) => (
            <div className="bg-white rounded-lg shadow-lg p-6">
                <h2 className="text-xl font-bold mb-4">{title}</h2>
                <select
                    value={category}
                    onChange={(e) => setCategory(e.target.value)}
                    className="w-full px-3 py-2 border rounded mb-3"
                >
                    <option value="">Seleccionar categorÃ­a</option>
                    {Object.keys(PROPERTIES).map(c => (
                        <option key={c} value={c}>{c}</option>
                    ))}
                </select>

                {category && (
                    <div className="space-y-2 mb-4 max-h-64 overflow-y-auto border rounded p-3">
                        {PROPERTIES[category].map((p, i) => (
                            <button
                                key={i}
                                onClick={() => onAdd(p)}
                                className="w-full text-left p-2 border rounded hover:bg-amber-50"
                            >
                                <div className="flex justify-between">
                                    <div className="flex-1">
                                        <div className="font-medium">{p.name}</div>
                                        <div className="text-xs text-gray-600">{p.note}</div>
                                    </div>
                                    <span className={`bg-${color}-600 text-white px-2 py-1 rounded text-sm ml-2`}>
                                        {p.cost} PPP
                                    </span>
                                </div>
                            </button>
                        ))}
                    </div>
                )}

                <div className="space-y-2">
                    {items.map(p => (
                        <div key={p.id} className={`flex justify-between items-center bg-${color}-50 p-3 rounded`}>
                            <div className="flex-1">
                                <div className="font-medium">{p.name}</div>
                                <div className="text-xs text-gray-600">{p.note}</div>
                            </div>
                            <div className="flex gap-2">
                                <span className={`bg-${color}-600 text-white px-2 py-1 rounded text-sm`}>
                                    {p.cost} PPP
                                </span>
                                <button onClick={() => onRemove(p.id)} className="text-red-600">
                                    <Trash2Icon />
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const RequirementSelector = ({ items, onAdd, onRemove }) => (
            <div className="bg-white rounded-lg shadow-lg p-6">
                <h2 className="text-xl font-bold mb-4">Requisitos (Reducen Coste)</h2>
                <p className="text-sm text-gray-600 mb-3">MÃ¡ximo 3</p>
                
                <div className="space-y-2 mb-4">
                    {REQUIREMENTS.map((r, i) => (
                        <button
                            key={i}
                            onClick={() => onAdd(r)}
                            className="w-full text-left p-2 border rounded hover:bg-green-50"
                        >
                            <div className="flex justify-between">
                                <div className="flex-1">
                                    <div className="font-medium">{r.name}</div>
                                    <div className="text-xs text-gray-600">{r.desc}</div>
                                </div>
                                <span className="bg-green-600 text-white px-2 py-1 rounded text-sm ml-2">
                                    {r.cost} PPP
                                </span>
                            </div>
                        </button>
                    ))}
                </div>

                <div className="space-y-2">
                    {items.map(r => (
                        <div key={r.id} className="flex justify-between items-center bg-green-50 p-3 rounded">
                            <span>{r.name}</span>
                            <div className="flex gap-2">
                                <span className="bg-green-600 text-white px-2 py-1 rounded text-sm">
                                    {r.cost} PPP
                                </span>
                                <button onClick={() => onRemove(r.id)} className="text-red-600">
                                    <Trash2Icon />
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const CurseSelector = ({ items, onAdd, onRemove, onUpdate }) => (
            <div className="bg-white rounded-lg shadow-lg p-6">
                <h2 className="text-xl font-bold mb-4">Maldiciones (Aumentan Poder)</h2>
                <p className="text-sm text-gray-600 mb-3">MÃ¡ximo 2</p>
                
                <div className="space-y-2 mb-4">
                    {CURSES.map((c, i) => (
                        <button
                            key={i}
                            onClick={() => onAdd(c)}
                            className="w-full text-left p-2 border rounded hover:bg-purple-50"
                        >
                            <div className="flex justify-between">
                                <div className="flex-1">
                                    <div className="font-medium">MaldiciÃ³n {c.name}</div>
                                    <div className="text-xs text-gray-600">{c.desc}</div>
                                </div>
                                <span className="bg-purple-600 text-white px-2 py-1 rounded text-sm ml-2">
                                    +{c.cost} PPP
                                </span>
                            </div>
                        </button>
                    ))}
                </div>

                <div className="space-y-2">
                    {items.map(c => (
                        <div key={c.id} className="bg-purple-50 p-3 rounded">
                            <div className="flex justify-between mb-2">
                                <span className="font-medium">MaldiciÃ³n {c.name}</span>
                                <div className="flex gap-2">
                                    <span className="bg-purple-600 text-white px-2 py-1 rounded text-sm">
                                        +{c.cost} PPP
                                    </span>
                                    <button onClick={() => onRemove(c.id)} className="text-red-600">
                                        <Trash2Icon />
                                    </button>
                                </div>
                            </div>
                            <textarea
                                value={c.details || ''}
                                onChange={(e) => onUpdate(c.id, e.target.value)}
                                placeholder="Detalles especÃ­ficos..."
                                className="w-full px-3 py-2 border roundetext-sm"
                                rows="2"
                            />
                        </div>
                    ))}
                </div>
            </div>
        );

        // Renderizar
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ItemCreator />);
    </script>
</body>
</html>
